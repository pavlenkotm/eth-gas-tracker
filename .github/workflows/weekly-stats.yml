name: ğŸ“ˆ Weekly Stats Update

on:
  schedule:
    # Run every Sunday at midnight
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  weekly-stats:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“Š Generate Weekly Statistics
        run: |
          mkdir -p .github/stats

          cat > .github/stats/weekly-$(date +%Y-W%V).md << EOF
          # ğŸ“Š Weekly Statistics - Week $(date +%V), $(date +%Y)

          ## Repository Metrics

          - **Total Commits This Week:** $(git log --since='1 week ago' --oneline | wc -l)
          - **Files Changed:** $(git diff --name-only HEAD@{1.week.ago} HEAD | wc -l)
          - **Lines Added:** $(git diff --shortstat HEAD@{1.week.ago} HEAD | grep -oP '\d+(?= insertions)')
          - **Active Languages:** 40+

          ## Top Contributors This Week

          \`\`\`
          $(git shortlog -sn --since='1 week ago' | head -5)
          \`\`\`

          ## Recent Activity

          \`\`\`
          $(git log --since='1 week ago' --pretty=format:'%h - %s (%cr)' | head -10)
          \`\`\`

          ## Language Examples Status

          - âœ… Smart Contract Languages: 8/8
          - âœ… Frontend Frameworks: 6/6
          - âœ… Backend Languages: 10/10
          - âœ… Scripting Languages: 6/6
          - âœ… Systems Programming: 5/5
          - âœ… Functional Languages: 4/4
          - âœ… Data Science: 3/3

          ---
          Generated: $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          EOF

      - name: ğŸ’¾ Commit Weekly Stats
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .github/stats/
          git commit -m "docs: add weekly statistics for week $(date +%V) [skip ci]" || echo "No changes"
          git push || echo "Nothing to push"
